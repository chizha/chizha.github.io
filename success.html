<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è®¢å•æäº¤æˆåŠŸ - é¸¡è›‹å·æ‰‹å·¥åŠ</title>
    <style>
        * { 
            margin: 0; 
            padding: 0; 
            box-sizing: border-box; 
        }
        
        body { 
            font-family: "PingFang SC", "Microsoft YaHei", sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 500px;
            margin: 0 auto;
            background: rgba(255,255,255,0.95);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .header h1 {
            color: #764ba2;
            font-size: 2.2em;
            margin-bottom: 10px;
        }
        
        .header p {
            color: #666;
        }
        
        /* æˆåŠŸå›¾æ ‡ */
        .success-icon {
            text-align: center;
            font-size: 4em;
            color: #4CAF50;
            margin-bottom: 20px;
        }
        
        /* è®¢å•å¡ç‰‡ */
        .order-card {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.05);
        }
        
        .order-info {
            margin-bottom: 20px;
        }
        
        .info-row {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid #eee;
        }
        
        .info-label {
            color: #666;
            font-weight: 500;
        }
        
        .info-value {
            font-weight: 600;
        }
        
        /* å•†å“æ˜ç»†æ ·å¼ */
        .product-details {
            margin: 10px 0 15px 0;
            padding: 15px;
            background: #f0f7ff;
            border-radius: 8px;
            border-left: 4px solid #2196F3;
        }
        
        .product-details-title {
            font-weight: 600;
            margin-bottom: 10px;
            color: #2196F3;
            font-size: 1.1em;
        }
        
        .product-item {
            display: flex;
            justify-content: space-between;
            margin: 8px 0;
            padding: 8px 0;
            border-bottom: 1px dashed #ddd;
        }
        
        .product-item:last-child {
            border-bottom: none;
        }
        
        .product-name {
            color: #555;
        }
        
        .product-qty {
            font-weight: bold;
            color: #2196F3;
        }
        
        .product-total-boxes {
            text-align: right;
            font-weight: 600;
            margin-top: 8px;
            color: #555;
            padding-top: 8px;
            border-top: 2px solid #ddd;
        }
        
        /* å–è´§ç  */
        .pickup-code {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            color: white;
            margin: 20px 0;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .pickup-number {
            font-size: 3em;
            font-weight: bold;
            letter-spacing: 5px;
            margin: 10px 0;
        }
        
        /* é¢„è®¡å®Œæˆæ—¶é—´ */
        .estimated-time {
            background: linear-gradient(135deg, #f6d365 0%, #fda085 100%);
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            color: white;
            margin: 20px 0;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .time-number {
            font-size: 2.2em;
            font-weight: bold;
            margin: 10px 0;
        }
        
        /* çŠ¶æ€è·Ÿè¸ª */
        .status-timeline {
            margin: 25px 0;
        }
        
        .status-item {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
            padding: 10px;
            border-radius: 8px;
            transition: all 0.3s ease;
        }
        
        .status-item.active {
            background: #e8f5e9;
            border-left: 5px solid #4CAF50;
        }
        
        .status-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            font-weight: bold;
            color: white;
        }
        
        .status-icon.waiting {
            background: #ff9800;
        }
        
        .status-icon.making {
            background: #2196F3;
        }
        
        .status-icon.ready {
            background: #4CAF50;
        }
        
        .status-details h3 {
            margin: 0 0 5px 0;
            color: #333;
        }
        
        .status-details p {
            margin: 0;
            color: #666;
            font-size: 0.9em;
        }
        
        /* æŒ‰é’® */
        .btn {
            display: block;
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            text-decoration: none;
            text-align: center;
            margin: 10px 0;
            transition: transform 0.2s, box-shadow 0.2s;
            box-shadow: 0 5px 15px rgba(76, 175, 80, 0.2);
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(76, 175, 80, 0.3);
        }
        
        .btn-blue {
            background: linear-gradient(135deg, #2196F3 0%, #1976d2 100%);
            box-shadow: 0 5px 15px rgba(33, 150, 243, 0.2);
        }
        
        .btn-purple {
            background: linear-gradient(135deg, #9C27B0 0%, #7B1FA2 100%);
            box-shadow: 0 5px 15px rgba(156, 39, 176, 0.2);
        }
        
        /* åŠ è½½åŠ¨ç”» */
        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }
        
        .loading-spinner {
            border: 3px solid #f3f3f3;
            border-radius: 50%;
            border-top: 3px solid #667eea;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* é¡µè„š */
        .footer {
            text-align: center;
            margin-top: 20px;
            color: #666;
            font-size: 0.9em;
        }
        
        /* å®Œæˆæ•ˆæœ */
        .completion-effect {
            animation: pulse 1.5s infinite;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        /* å£°éŸ³å¼€å…³ */
        .sound-toggle {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            margin: 15px 0;
            padding: 10px;
            background: #f5f5f5;
            border-radius: 8px;
        }
        
        /* åˆ·æ–°æŒ‡ç¤º */
        .refresh-indicator {
            text-align: center;
            font-size: 0.8em;
            color: #666;
            margin-top: 10px;
        }
        
        /* è‡ªåŠ¨åˆ·æ–°å¼€å…³ */
        .refresh-toggle {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            margin: 15px 0;
            padding: 10px;
            background: #f5f5f5;
            border-radius: 8px;
        }
        
        /* è®¢å•çŠ¶æ€è¯´æ˜ */
        .status-note {
            text-align: center;
            color: #666;
            font-size: 0.9em;
            margin-top: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="success-icon">âœ…</div>
        
        <div class="header">
            <h1>è®¢å•æäº¤æˆåŠŸï¼</h1>
            <p>æ‚¨çš„è®¢å•å·²è¿›å…¥åˆ¶ä½œé˜Ÿåˆ—</p>
        </div>

        <div id="orderContent">
            <!-- è®¢å•ä¿¡æ¯ -->
            <div class="order-card">
                <h2 style="text-align:center; margin-bottom:20px;">ğŸ“‹ è®¢å•è¯¦æƒ…</h2>
                
                <div class="order-info">
                    <div class="info-row">
                        <div class="info-label">é¡¾å®¢å§“å</div>
                        <div class="info-value" id="customerName">--</div>
                    </div>
                    <div class="info-row">
                        <div class="info-label">æ‰‹æœºå·ç </div>
                        <div class="info-value" id="phone">--</div>
                    </div>
                    
                    <!-- å•†å“æ˜ç»† -->
                    <div class="product-details" id="productDetailsContainer">
                        <div class="product-details-title">ğŸ“¦ å•†å“æ˜ç»†</div>
                        <div id="productDetails">
                            <!-- å•†å“æ˜ç»†å°†åœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
                        </div>
                        <div id="productTotalBoxes" class="product-total-boxes">
                            å…± 0 ç›’
                        </div>
                    </div>
                    
                    <div class="info-row">
                        <div class="info-label">æ€»ç›’æ•°</div>
                        <div class="info-value" id="totalBoxes">0 ç›’</div>
                    </div>
                    <div class="info-row">
                        <div class="info-label">è®¢å•é‡‘é¢</div>
                        <div class="info-value" id="totalPrice">0 å…ƒ</div>
                    </div>
                </div>
                
                <!-- å–è´§ç  -->
                <div class="pickup-code">
                    <div>ğŸ“¦ å–è´§ç </div>
                    <div id="pickupCode" class="pickup-number">J-596</div>
                    <div>è¯·æˆªå›¾ä¿å­˜æ­¤å–è´§ç </div>
                </div>
                
                <!-- é¢„è®¡å®Œæˆæ—¶é—´ -->
                <div class="estimated-time">
                    <div>â° é¢„è®¡å®Œæˆæ—¶é—´</div>
                    <div id="estimatedTime" class="time-number">2025/12/24 13:32</div>
                    <div>é¡µé¢å°†è‡ªåŠ¨æ›´æ–°è®¢å•çŠ¶æ€</div>
                </div>
            </div>
            
            <!-- çŠ¶æ€è·Ÿè¸ª -->
            <div class="order-card">
                <h2 style="text-align:center; margin-bottom:20px;">ğŸ“ˆ è®¢å•çŠ¶æ€è·Ÿè¸ª</h2>
                
                <div class="status-timeline">
                    <!-- çŠ¶æ€1ï¼šæ’é˜Ÿä¸­ -->
                    <div class="status-item active" id="statusWaiting">
                        <div class="status-icon waiting">1</div>
                        <div class="status-details">
                            <h3>æ’é˜Ÿä¸­</h3>
                            <p>è®¢å•å·²æäº¤ï¼Œç­‰å¾…åˆ¶ä½œ</p>
                        </div>
                    </div>
                    
                    <!-- çŠ¶æ€2ï¼šåˆ¶ä½œä¸­ -->
                    <div class="status-item" id="statusMaking">
                        <div class="status-icon making">2</div>
                        <div class="status-details">
                            <h3>åˆ¶ä½œä¸­</h3>
                            <p>å¸ˆå‚…æ­£åœ¨åˆ¶ä½œæ‚¨çš„è›‹å·</p>
                        </div>
                    </div>
                    
                    <!-- çŠ¶æ€3ï¼šå·²å®Œæˆ -->
                    <div class="status-item" id="statusReady">
                        <div class="status-icon ready">3</div>
                        <div class="status-details">
                            <h3>å·²å®Œæˆ</h3>
                            <p>æ‚¨çš„è›‹å·å·²åˆ¶ä½œå®Œæˆï¼Œè¯·å‡­å–è´§ç å–è´§</p>
                        </div>
                    </div>
                </div>
                
                <!-- è‡ªåŠ¨åˆ·æ–°å¼€å…³ -->
                <div class="refresh-toggle">
                    <input type="checkbox" id="autoRefresh" checked>
                    <label for="autoRefresh">è‡ªåŠ¨åˆ·æ–°è®¢å•çŠ¶æ€ï¼ˆæ¯30ç§’ï¼‰</label>
                </div>
                
                <div class="refresh-indicator" id="refreshTime">
                    æœ€ååˆ·æ–°: --
                </div>
            </div>
            
            <!-- æ“ä½œæŒ‰é’® -->
            <button onclick="checkOrderStatus()" class="btn btn-blue">
                ğŸ”„ æ‰‹åŠ¨åˆ·æ–°çŠ¶æ€
            </button>
            
            <button onclick="window.location.href='order.html'" class="btn btn-purple">
                ğŸ“ ç»§ç»­ä¸‹å•
            </button>
            
            <a href="index.html" class="btn">
                ğŸ  è¿”å›é¦–é¡µ
            </a>
        </div>
        
        <div class="loading" id="loadingIndicator">
            <div class="loading-spinner"></div>
            <p>æ­£åœ¨è·å–è®¢å•çŠ¶æ€...</p>
        </div>
        
        <!-- å®Œæˆæç¤º -->
        <div class="order-card" id="completionNotice" style="display:none;">
            <div style="text-align:center;">
                <div style="font-size:3em; color:#4CAF50; margin-bottom:10px;">ğŸ‰</div>
                <h2 style="color:#4CAF50;">æ‚¨çš„è›‹å·å·²åˆ¶ä½œå®Œæˆï¼</h2>
                <p style="margin:10px 0;">è¯·å‡­å–è´§ç åˆ°æŸœå°å–è´§</p>
                <div id="pickupCodeFinal" style="font-size:2em; font-weight:bold; margin:15px 0;">J-596</div>
                <p style="color:#666; font-size:0.9em;">æ„Ÿè°¢æ‚¨çš„å…‰ä¸´ï¼Œæ¬¢è¿å†æ¬¡ä¸‹å•ï¼</p>
            </div>
        </div>

        <div class="footer">
            <p>é¸¡è›‹å·æ‰‹å·¥åŠ | å®æ—¶è®¢å•è·Ÿè¸ªç³»ç»Ÿ</p>
        </div>
    </div>

    <script>
        // äº§å“åç§°å’Œä»·æ ¼é…ç½®
        const PRODUCTS = [
            { id: 'original', name: 'ğŸ¥š åŸå‘³è›‹å·', price: 12 },
            { id: 'seaweed', name: 'ğŸ˜ ç´«èœè‚‰æ¾å·', price: 12 },
            { id: 'coconut', name: 'ğŸ¥¥ æ¤°è“‰æ¤°ä¸å·', price: 12 }
        ];

        // è®¢å•ä¿¡æ¯
        let orderInfo = null;
        let refreshInterval = null;
        let autoRefreshEnabled = true;
        let completionAlerted = false;

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            console.log('success.html åˆå§‹åŒ–...');
            
            // ä»localStorageè·å–è®¢å•ä¿¡æ¯
            const savedOrder = localStorage.getItem('lastOrder');
            if (savedOrder) {
                try {
                    orderInfo = JSON.parse(savedOrder);
                    console.log('ä»localStorageè·å–çš„è®¢å•ä¿¡æ¯:', orderInfo);
                    
                    if (orderInfo) {
                        displayOrderInfo();
                    }
                } catch (error) {
                    console.error('è§£ælocalStorageæ•°æ®å¤±è´¥:', error);
                }
            } else {
                // å¦‚æœæ²¡æœ‰è®¢å•ä¿¡æ¯ï¼Œå°è¯•ä»URLå‚æ•°è·å–
                const urlParams = new URLSearchParams(window.location.search);
                const orderId = urlParams.get('orderId');
                
                if (orderId) {
                    console.log('ä»URLè·å–è®¢å•ID:', orderId);
                } else {
                    // è·³å›ä¸‹å•é¡µé¢
                    alert('æœªæ‰¾åˆ°è®¢å•ä¿¡æ¯ï¼Œè¯·é‡æ–°ä¸‹å•');
                    window.location.href = 'order.html';
                }
                return;
            }
            
            // è®¾ç½®è‡ªåŠ¨åˆ·æ–°
            setupAutoRefresh();
            
            // ç›‘å¬è‡ªåŠ¨åˆ·æ–°å¼€å…³
            document.getElementById('autoRefresh').addEventListener('change', function() {
                autoRefreshEnabled = this.checked;
                if (autoRefreshEnabled && !refreshInterval) {
                    setupAutoRefresh();
                } else if (!autoRefreshEnabled && refreshInterval) {
                    clearInterval(refreshInterval);
                    refreshInterval = null;
                }
            });
            
            // ç«‹å³æ£€æŸ¥ä¸€æ¬¡è®¢å•çŠ¶æ€
            checkOrderStatus();
        });

        // æ˜¾ç¤ºè®¢å•ä¿¡æ¯
        function displayOrderInfo() {
            if (!orderInfo) {
                console.error('orderInfoä¸ºç©ºï¼Œæ— æ³•æ˜¾ç¤ºè®¢å•ä¿¡æ¯');
                return;
            }
            
            console.log('æ˜¾ç¤ºè®¢å•ä¿¡æ¯:', orderInfo);
            
            // å¡«å……åŸºæœ¬ä¿¡æ¯
            document.getElementById('customerName').textContent = orderInfo.customerName || '--';
            document.getElementById('phone').textContent = orderInfo.phone || '--';
            document.getElementById('totalBoxes').textContent = (orderInfo.totalBoxes || 0) + ' ç›’';
            document.getElementById('totalPrice').textContent = (orderInfo.totalPrice || 0) + ' å…ƒ';
            document.getElementById('pickupCode').textContent = orderInfo.pickupCode || 'J-596';
            document.getElementById('estimatedTime').textContent = orderInfo.estimatedTime || '2025/12/24 13:32';
            document.getElementById('pickupCodeFinal').textContent = orderInfo.pickupCode || 'J-596';
            
            // æ˜¾ç¤ºå•†å“æ˜ç»†
            displayProductDetails();
        }

        // æ˜¾ç¤ºå•†å“æ˜ç»†
        function displayProductDetails() {
            if (!orderInfo) {
                console.error('orderInfoä¸ºç©ºï¼Œæ— æ³•æ˜¾ç¤ºå•†å“æ˜ç»†');
                return;
            }
            
            const productDetailsDiv = document.getElementById('productDetails');
            productDetailsDiv.innerHTML = '';
            
            // è·å–å„äº§å“æ•°é‡
            const originalQty = orderInfo.originalQty || 0;
            const seaweedQty = orderInfo.seaweedQty || 0;
            const coconutQty = orderInfo.coconutQty || 0;
            
            console.log('å•†å“æ•°é‡:', { originalQty, seaweedQty, coconutQty });
            
            // è®¡ç®—æ€»ç›’æ•°
            const totalBoxes = originalQty + seaweedQty + coconutQty;
            document.getElementById('productTotalBoxes').textContent = 'å…± ' + totalBoxes + ' ç›’';
            
            // æ˜¾ç¤ºå•†å“æ˜ç»†
            let hasProducts = false;
            
            if (originalQty > 0) {
                addProductDetail('original', originalQty);
                hasProducts = true;
            }
            
            if (seaweedQty > 0) {
                addProductDetail('seaweed', seaweedQty);
                hasProducts = true;
            }
            
            if (coconutQty > 0) {
                addProductDetail('coconut', coconutQty);
                hasProducts = true;
            }
            
            // å¦‚æœæ²¡æœ‰å•†å“ï¼Œæ˜¾ç¤ºæç¤º
            if (!hasProducts) {
                productDetailsDiv.innerHTML = '<div style="color:#999; text-align:center;">æš‚æ— å•†å“æ˜ç»†</div>';
            }
            
            // ç¡®ä¿å•†å“æ˜ç»†åŒºåŸŸå¯è§
            document.getElementById('productDetailsContainer').style.display = 'block';
        }

        // æ·»åŠ å•ä¸ªå•†å“æ˜ç»†
        function addProductDetail(productId, quantity) {
            const productDetailsDiv = document.getElementById('productDetails');
            
            const product = PRODUCTS.find(p => p.id === productId);
            if (!product) {
                console.error('æœªæ‰¾åˆ°äº§å“:', productId);
                return;
            }
            
            const productItem = document.createElement('div');
            productItem.className = 'product-item';
            
            const totalPrice = quantity * product.price;
            
            productItem.innerHTML = `
                <div class="product-name">${product.name}</div>
                <div class="product-qty">${quantity}ç›’ Ã— ${product.price}å…ƒ = ${totalPrice}å…ƒ</div>
            `;
            
            productDetailsDiv.appendChild(productItem);
        }

        // è®¾ç½®è‡ªåŠ¨åˆ·æ–°
        function setupAutoRefresh() {
            if (refreshInterval) {
                clearInterval(refreshInterval);
            }
            
            refreshInterval = setInterval(() => {
                if (autoRefreshEnabled) {
                    checkOrderStatus();
                }
            }, 30000); // æ¯30ç§’åˆ·æ–°ä¸€æ¬¡
        }

        // æ›´æ–°åˆ·æ–°æ—¶é—´æ˜¾ç¤º
        function updateRefreshTime() {
            const now = new Date();
            document.getElementById('refreshTime').textContent = 
                'æœ€ååˆ·æ–°: ' + now.toLocaleTimeString('zh-CN', {
                    hour: '2-digit',
                    minute: '2-digit',
                    second: '2-digit'
                });
        }

        // æ£€æŸ¥è®¢å•çŠ¶æ€
        async function checkOrderStatus() {
            if (!orderInfo || !orderInfo.recordId) {
                console.error('æ²¡æœ‰è®¢å•IDï¼Œæ— æ³•æ£€æŸ¥çŠ¶æ€');
                return;
            }
            
            try {
                // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
                document.getElementById('loadingIndicator').style.display = 'block';
                
                // æ¨¡æ‹ŸAPIè°ƒç”¨
                setTimeout(() => {
                    // æ¨¡æ‹ŸAPIå“åº”
                    const mockStatus = getRandomStatus();
                    updateOrderStatus(mockStatus);
                    
                    // æ›´æ–°åˆ·æ–°æ—¶é—´
                    updateRefreshTime();
                    
                    // éšè—åŠ è½½çŠ¶æ€
                    document.getElementById('loadingIndicator').style.display = 'none';
                }, 1000);
                
            } catch (error) {
                console.error('æ£€æŸ¥è®¢å•çŠ¶æ€æ—¶å‡ºé”™:', error);
                document.getElementById('loadingIndicator').style.display = 'none';
            }
        }

        // æ¨¡æ‹Ÿè·å–éšæœºçŠ¶æ€
        function getRandomStatus() {
            const currentStatus = document.getElementById('statusWaiting').classList.contains('active') ? 'æ’é˜Ÿä¸­' : 
                                 document.getElementById('statusMaking').classList.contains('active') ? 'åˆ¶ä½œä¸­' : 'å·²å®Œæˆ';
            
            // æ¨¡æ‹ŸçŠ¶æ€æ¨è¿›
            if (currentStatus === 'æ’é˜Ÿä¸­') {
                return Math.random() > 0.7 ? 'åˆ¶ä½œä¸­' : 'æ’é˜Ÿä¸­';
            } else if (currentStatus === 'åˆ¶ä½œä¸­') {
                return Math.random() > 0.7 ? 'å·²å®Œæˆ' : 'åˆ¶ä½œä¸­';
            } else {
                return 'å·²å®Œæˆ';
            }
        }

        // æ›´æ–°è®¢å•çŠ¶æ€æ˜¾ç¤º
        function updateOrderStatus(status) {
            console.log('è®¢å•çŠ¶æ€æ›´æ–°ä¸º:', status);
            
            // é‡ç½®æ‰€æœ‰çŠ¶æ€
            document.getElementById('statusWaiting').classList.remove('active');
            document.getElementById('statusMaking').classList.remove('active');
            document.getElementById('statusReady').classList.remove('active');
            
            // æ ¹æ®çŠ¶æ€æ›´æ–°æ˜¾ç¤º
            if (status === 'æ’é˜Ÿä¸­') {
                document.getElementById('statusWaiting').classList.add('active');
            } else if (status === 'åˆ¶ä½œä¸­') {
                document.getElementById('statusWaiting').classList.add('active');
                document.getElementById('statusMaking').classList.add('active');
            } else if (status === 'å·²å®Œæˆ') {
                document.getElementById('statusWaiting').classList.add('active');
                document.getElementById('statusMaking').classList.add('active');
                document.getElementById('statusReady').classList.add('active');
                
                // æ˜¾ç¤ºå®Œæˆæç¤º
                showCompletionNotice();
                
                // åœæ­¢è‡ªåŠ¨åˆ·æ–°
                if (refreshInterval) {
                    clearInterval(refreshInterval);
                    refreshInterval = null;
                }
                
                // æ’­æ”¾å®Œæˆæç¤ºéŸ³
                if (!completionAlerted) {
                    playCompletionSound();
                    completionAlerted = true;
                }
            }
        }

        // æ˜¾ç¤ºå®Œæˆé€šçŸ¥
        function showCompletionNotice() {
            const completionNotice = document.getElementById('completionNotice');
            const orderContent = document.getElementById('orderContent');
            
            // éšè—åŸæœ‰å†…å®¹
            orderContent.style.display = 'none';
            
            // æ˜¾ç¤ºå®Œæˆé€šçŸ¥
            completionNotice.style.display = 'block';
            completionNotice.classList.add('completion-effect');
        }

        // æ’­æ”¾å®Œæˆæç¤ºéŸ³
        function playCompletionSound() {
            try {
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.frequency.setValueAtTime(440, audioContext.currentTime);
                oscillator.frequency.setValueAtTime(554.37, audioContext.currentTime + 0.1);
                oscillator.frequency.setValueAtTime(659.25, audioContext.currentTime + 0.2);
                
                gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);
                
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + 0.5);
                
            } catch (error) {
                console.log('éŸ³é¢‘æ’­æ”¾å¤±è´¥:', error);
            }
        }

        // é¡µé¢å¯è§æ€§å˜åŒ–å¤„ç†
        document.addEventListener('visibilitychange', function() {
            if (!document.hidden && autoRefreshEnabled) {
                checkOrderStatus();
            }
        });
    </script>
</body>
</html>